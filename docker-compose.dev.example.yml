# ==========================================
# LabOS - Local Development Environment (Example)
# ==========================================
# Copy to docker-compose.dev.yml
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build
#
# This runs everything locally on localhost
# Frontend: http://localhost:3000
# Backend:  http://localhost:18800
# ==========================================

services:
  backend:
    environment:
      # Core settings
      - ENVIRONMENT=development
      - DEBUG=true
      - PORT=18800
      # URLs (localhost for local development)
      - FRONTEND_URL=http://localhost:3000
      - BACKEND_URL=http://localhost:18800
      - CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
      - AUTH0_BASE_URL=http://localhost:3000
      # Sandbox storage
      - SANDBOX_ROOT=/data/sandboxes
      - SYNC_TO_GCS=false
      # Feature flags
      - ENABLE_MEMORY=false

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        # Build-time args for Next.js
        # Backend: empty string = use relative URLs (/api/*) + Next.js rewrites
        # This way browser calls /api/v1/auth/me, Next.js proxies to backend:18800
        NEXT_PUBLIC_BACKEND_URL: ""
        NEXT_PUBLIC_WEBSOCKET_URL: ws://localhost:18800/ws
    environment:
      - NODE_ENV=development
      - AUTH0_BASE_URL=http://localhost:3000
